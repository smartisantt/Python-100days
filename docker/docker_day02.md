> Author: 陈伦巨
>
> Data: 2019-07-29
>
> Email: 545560793@qq.com
>
> github: https://github.com/smartisantt



#### Docker历史

Docker最初是dotCloud公司创始人Solomon Hykes在法国期间发起的一个公司内部项目，它是基于dotCloud公司多年云服务技术的一次革新，并于2013年3月以Apache2.0授权协议开源，主要项目代码在GitHub上进行维护。Docker项目后来还加入了Linux基金会，并成立推动开放容器联盟（OCI）。

Docker 使用Google公司推出的Go语言进行开发实现，基于Linux内核的cgroup，namespace，以及AUFS类的Union FS等技术，对进程进行封装隔离，数据操作系统层面的虚拟化技术。



#### Docker和传统虚拟化方式的区别

传统虚拟机技术是虚拟出一套硬件后，在再上面运行一个完整的操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。

使用Docker的优势：

1. 更高效的利用系统资源
2. 更快速的启动时间
3. 一致的运行环境
4. 持续交付和部署
5. 更轻松的迁移
6. 更轻松的维护和扩展



#### Docker的三个基本概念

1. 镜像（Image）
2. 容器（Container）
3. 仓库（Repository）



##### Docker镜像

Docker镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会改变。Docker设计时，充分利用Union FS的技术，将其设计为**分层存储**的架构。镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层。



##### Docker容器

镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的**类**和**实例**一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。

容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行属于自己的独立的命名空间。

前面讲过镜像使用的是分层存储，容器也是如此。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，我们称这个为容器运行时读写而准备的存储层为**容器存储层**。

容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。

按照Docker最佳实践的要求，容器不应该向其存储层内写入任何数据，**容器存储层要保持无状态化**。所有的文件写入操作，都应该使用	**数据卷（Volume）**、或者绑定宿主目录，在这些位置的读写会跳过容器存储层，直接对宿主（或网络存储）发生读写，其性能和稳定性更高。数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此，使用数据卷后，容器删除或者重新运行之后，数据却不会丢失。



#### 仓库

一个Docker Registry 中可以包含多个仓库（Repository）；每个仓库可以包含多个标签(Tag)；每个标签对应一个镜像。

从Docker镜像仓库获取镜像的命令是`docker pull`



#### 使用Dockerfile定制镜像

使用`docker commit`命令虽然可以比较直观的帮助理解镜像分层存储的概念，但是实际环境中不会这样使用。

如果使用`docker  commit`制作镜像，以及后期修改的话，每一次修改都会让镜像更加臃肿一次，所删除的上一层的东西不会丢失，会一直跟着这个对象，即使更本无法访问到。这会让镜像更加臃肿。

**不要使用`docker commit`定制镜像，定制镜像应该使用`Dockerfile`来完成。**



Dockerfiler 指令详解



| 命令         | 说明                                             |
| ------------ | ------------------------------------------------ |
| `FROM`       | 指定基础镜像，必须是第一条指令                   |
| `RUN`        | 用来执行命令行（shell格式、exec格式）            |
| `COPY`       | 复制文件                                         |
| `ADD`        | 和`COPY`一样，增加了原路径可以是URL或tar压缩文件 |
| `CMD`        | 和`RUN`相似，也是两种格式                        |
| `ENTRYPOINT` |                                                  |
|              |                                                  |
|              |                                                  |
|              |                                                  |
|              |                                                  |
|              |                                                  |
|              |                                                  |
|              |                                                  |

